function getFoursquareRequestURL(a){return foursquareEP+a+"?client_id="+clientID+"&client_secret="+clientSecret+"&v=20151220&m=foursquare"}function checkIfDefined(a){return"undefined"!=typeof a&&null!==a?!0:!1}function initMap(){var a=[{stylers:[{saturation:-40},{lightness:20}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],b={center:{lat:59.332309,lng:18.064582},zoom:14,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,styles:a};map=new Map(b,a),map.setupMarkers(),map.setupInfoWindows(locationData)}function ViewModel(){var a=this;a.searchQuery=ko.observable("Search"),a.searchResults=ko.computed(function(){if(""==a.searchQuery()||"Search"==a.searchQuery())return"undefined"!=typeof map&&null!==map&&(map.clearMarkers(),map.setupMarkers()),locationData;for(var b=[],c=0;c<locationData.length;c++)locationData[c].title.toLowerCase().indexOf(a.searchQuery().toLowerCase())>=0&&b.push(locationData[c]);return map.filterMarkers(b),b}),a.selectLocation=function(a){var b=locationData.indexOf(a);map.toggleInfoWindow(b)},a.searchQuery.subscribe(function(){map.filterMarkers(a.searchResults())})}var locationData=[{title:"Fotografiska",pos:{lat:59.3178187,lng:18.0858394},category:"Museum",foursquareVenueID:"4bf57390706e20a1067daa98"},{title:"Gr√∂na Lund",pos:{lat:59.3233503,lng:18.0963003},category:"Amusement Park",foursquareVenueID:"4adcdaeef964a520a05a21e3"},{title:"Moderna Museet",pos:{lat:59.3260426,lng:18.084607},category:"Museum",foursquareVenueID:"4adcdaeff964a520e45a21e3"},{title:"Stadsbiblioteket",pos:{lat:59.3434101,lng:18.0546555},category:"Library",foursquareVenueID:"4adcdaeef964a520b65a21e3"},{title:"Skype",pos:{lat:59.3206951,lng:18.0514177},category:"Tech Company",foursquareVenueID:"4c07887a8a81c9b651502790"},{title:"Bonnier Museum",pos:{lat:59.3369941,lng:18.0425881},category:"Museum",foursquareVenueID:"4af1b187f964a52044e221e3"},{title:"Google",pos:{lat:59.333404,lng:18.0543282},category:"Tech Company",foursquareVenueID:"4bd8263335aad13afd2690f3"},{title:"Spotify",pos:{lat:59.3422246,lng:18.0637341},category:"Tech Company",foursquareVenueID:"4ff1826fe4b0cf98814a6b9b"}],foursquareEP="https://api.foursquare.com/v2/venues/",clientID="ABND2BJJYOCBN02BNPOIUXZL34AFIPQK4WC3DRAREHKVMPNQ",clientSecret="NGNJHIY1DH13PHPRGDEUZCXKSISR404GPWOX4LBBFEBOZMYU",getFoursquareVenueData=function(a){$.getJSON(getFoursquareRequestURL(locationData[a].foursquareVenueID),function(b){var c=b.response.venue;locationData[a].FQdescription=checkIfDefined(c.description)?"<p>"+c.description+"</p>":"",locationData[a].FQrating=checkIfDefined(c.rating)?"<p>Foursquare rating: "+c.rating+"</p>":"",locationData[a].FQurl=checkIfDefined(c.url)?'<a href="'+c.url+'">Website</a>':"",map.infoWindows[a]=new google.maps.InfoWindow({content:"<h1>"+locationData[a].title+"</h1><h3>"+locationData[a].category+"</h3>"+locationData[a].FQdescription+locationData[a].FQrating+locationData[a].FQurl})}).fail(function(){return map.infoWindows[a]=new google.maps.InfoWindow({content:"<h1>"+locationData[a].title+"</h1><h3>"+locationData[a].category+"</h3><p>"+locationData[a].content+'</p><p class="error">Foursquare info could not be loaded.</p>'}),"Foursquare info could not be loaded."})},Map=function(a,b){this.mapStyles=b,this.infoWindows=[],this.markers=[],this.map=new google.maps.Map(document.getElementById("map"),a)};Map.prototype.setupMarkers=function(){var a=this;a.clearMarkers();for(var b=0;b<locationData.length;b++){var c={position:locationData[b].pos,title:locationData[b].title};a.markers[b]=new google.maps.Marker(c),a.markers[b].setMap(a.map),a.markers[b].setAnimation(google.maps.Animation.DROP),function(b){a.markers[b].addListener("click",function(){a.toggleInfoWindow(b)})}(b)}},Map.prototype.clearMarkers=function(){for(var a=this,b=0;b<a.markers.length;b++)!function(b){a.markers[b].setMap(null)}(b)},Map.prototype.filterMarkers=function(a){var b=this;for(b.clearMarkers(),i=0;i<a.length;i++){var c=locationData.indexOf(a[i]);!function(a){c>=0&&(b.markers[c].setMap(b.map),b.markers[c].setAnimation(google.maps.Animation.DROP))}(i)}},Map.prototype.setupInfoWindows=function(a){var b=this;for(b.infoWindows=[],i=0;i<locationData.length;i++)getFoursquareVenueData(i)},Map.prototype.toggleInfoWindow=function(a){var b=this.markers[a],c=this.infoWindows[a];null!==b.getAnimation()?(b.setAnimation(null),c.close()):(b.setAnimation(google.maps.Animation.BOUNCE),c.open(this.map,b))};var map;ko.applyBindings(new ViewModel);