"use strict";function getFoursquareRequestURL(a){return FOURSQUARE_EP+a+"?client_id="+CLIENT_ID+"&client_secret="+CLIENT_SECRET+"&v=20151220&m=foursquare"}function checkIfDefined(a){return"undefined"!=typeof a&&null!==a?!0:!1}function errorMap(){alert("There was a problem connecting to Google. Please check your Internet connection.")}function initMap(){var a=[{stylers:[{saturation:-40},{lightness:20}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{lightness:100},{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}],b={center:{lat:59.332309,lng:18.064582},zoom:14,mapTypeControl:!1,panControl:!1,zoomControl:!1,streetViewControl:!1,styles:a};map=new Map(b,a),map.setupMarkers(),map.setupInfoWindows()}function ViewModel(){var a=this;a.searchQuery=ko.observable(""),a.searchResults=ko.computed(function(){if(""===a.searchQuery())return"undefined"!=typeof map&&null!==map&&(map.clearMarkers(),map.setupMarkers()),locationData;for(var b=[],c=0,d=locationData.length;d>c;c++)locationData[c].title.toLowerCase().indexOf(a.searchQuery().toLowerCase())>=0&&b.push(locationData[c]);return map.filterMarkers(b),b}),a.selectLocation=function(a){var b=locationData.indexOf(a);map.toggleInfoWindow(b)},a.searchQuery.subscribe(function(){map.filterMarkers(a.searchResults())})}var locationData=[{title:"Fotografiska",pos:{lat:59.3178187,lng:18.0858394},category:"Museum",foursquareVenueID:"4bf57390706e20a1067daa98"},{title:"Gr√∂na Lund",pos:{lat:59.3233503,lng:18.0963003},category:"Amusement Park",foursquareVenueID:"4adcdaeef964a520a05a21e3"},{title:"Moderna Museet",pos:{lat:59.3260426,lng:18.084607},category:"Museum",foursquareVenueID:"4adcdaeff964a520e45a21e3"},{title:"Stadsbiblioteket",pos:{lat:59.3434101,lng:18.0546555},category:"Library",foursquareVenueID:"4adcdaeef964a520b65a21e3"},{title:"Skype",pos:{lat:59.3206951,lng:18.0514177},category:"Tech Company",foursquareVenueID:"4c07887a8a81c9b651502790"},{title:"Bonnier Museum",pos:{lat:59.3369941,lng:18.0425881},category:"Museum",foursquareVenueID:"4af1b187f964a52044e221e3"},{title:"Google",pos:{lat:59.333404,lng:18.0543282},category:"Tech Company",foursquareVenueID:"4bd8263335aad13afd2690f3"},{title:"Spotify",pos:{lat:59.3422246,lng:18.0637341},category:"Tech Company",foursquareVenueID:"4ff1826fe4b0cf98814a6b9b"}],FOURSQUARE_EP="https://api.foursquare.com/v2/venues/",CLIENT_ID="ABND2BJJYOCBN02BNPOIUXZL34AFIPQK4WC3DRAREHKVMPNQ",CLIENT_SECRET="NGNJHIY1DH13PHPRGDEUZCXKSISR404GPWOX4LBBFEBOZMYU",getFoursquareVenueData=function(a){$.getJSON(getFoursquareRequestURL(locationData[a].foursquareVenueID),function(b){var c=b.response.venue;locationData[a].FQdescription=checkIfDefined(c.description)?"<p>"+c.description+"</p>":"",locationData[a].FQrating=checkIfDefined(c.rating)?"<p>Foursquare rating: "+c.rating+"</p>":"",locationData[a].FQurl=checkIfDefined(c.url)?'<a href="'+c.url+'" target="_blank">Website</a>':"",map.infoWindows[a]=new google.maps.InfoWindow({content:"<h1>"+locationData[a].title+"</h1><h3>"+locationData[a].category+"</h3>"+locationData[a].FQdescription+locationData[a].FQrating+locationData[a].FQurl}),google.maps.event.addListener(map.infoWindows[a],"closeclick",function(){map.markers[a].setAnimation(null)})}).fail(function(){return map.infoWindows[a]=new google.maps.InfoWindow({content:"<h1>"+locationData[a].title+"</h1><h3>"+locationData[a].category+"</h3><p>"+locationData[a].content+'</p><p class="error">Foursquare info could not be loaded.</p>'}),google.maps.event.addListener(map.infoWindows[a],"closeclick",function(){map.markers[a].setAnimation(null)}),"Foursquare info could not be loaded."})},Map=function(a,b){this.mapStyles=b,this.infoWindows=[],this.markers=[],this.map=new google.maps.Map(document.getElementById("map"),a)};Map.prototype.setupMarkers=function(){var a=this;a.clearMarkers();for(var b=0,c=locationData.length;c>b;b++){var d={position:locationData[b].pos,title:locationData[b].title};a.markers[b]=new google.maps.Marker(d),a.markers[b].setMap(a.map),a.markers[b].setAnimation(google.maps.Animation.DROP),function(b){a.markers[b].addListener("click",function(){a.toggleInfoWindow(b)})}(b)}},Map.prototype.clearMarkers=function(){for(var a=this,b=0,c=a.markers.length;c>b;b++)!function(b){a.markers[b].setMap(null)}(b)},Map.prototype.filterMarkers=function(a){var b=this;b.clearMarkers();for(var c=0,d=a.length;d>c;c++){var e=locationData.indexOf(a[c]);e>=0&&(b.markers[e].setMap(b.map),b.markers[e].setAnimation(google.maps.Animation.DROP))}},Map.prototype.setupInfoWindows=function(){var a=this;a.infoWindows=[];for(var b=0,c=locationData.length;c>b;b++)getFoursquareVenueData(b)},Map.prototype.clearInfoWindows=function(){for(var a=this,b=0,c=locationData.length;c>b;b++)a.markers[b].setAnimation(null),a.infoWindows[b].close()},Map.prototype.toggleInfoWindow=function(a){var b=this.markers[a],c=this.infoWindows[a];null!==b.getAnimation()?(b.setAnimation(null),c.close()):(this.clearInfoWindows(),b.setAnimation(google.maps.Animation.BOUNCE),c.open(this.map,b))};var map;ko.applyBindings(new ViewModel);